<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å°åŒ—è¡Œç¨‹ & å›¢ä½“è®°è´¦ v4ï¼ˆç¦»çº¿ï¼‰</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="assets/icon-192.png">
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root{
      --bg:#0b1220; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --brand:#0ea5e9;
      --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --line:#334155; --input:#0b1020;
    }
    .light{
      --bg:#f7f7fb; --card:#ffffff; --muted:#64748b; --text:#0f172a; --brand:#0ea5e9;
      --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --line:#d0d7e2; --input:#f2f4f8;
    }
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, 'PingFang SC', 'Noto Sans CJK', 'Microsoft YaHei', Arial, sans-serif; background:var(--bg); color:var(--text); }
    header{ position:sticky; top:0; z-index:30; backdrop-filter: blur(10px); background:rgba(11,18,32,.7); border-bottom:1px solid var(--line); }
    .light header{ background:rgba(255,255,255,.7); }
    .wrap{ max-width:1200px; margin:0 auto; padding:0 16px; }
    .nav{ display:flex; gap:8px; overflow:auto; padding:10px 0; align-items:center;}
    .nav a{ white-space:nowrap; text-decoration:none; color:var(--text); padding:8px 12px; border-radius:999px; border:1px solid var(--line); }
    .nav a.active, .nav a:hover{ background:var(--brand); color:black; border-color:transparent; }
    .spacer{ flex:1 1 auto; }
    .theme{ border-radius:999px; padding:6px 10px; border:1px solid var(--line); background:transparent; color:var(--text); cursor:pointer;}
    main{ padding:16px 0 60px; }
    h2{ margin:20px 0 10px; display:flex; align-items:center; gap:8px; font-size:20px; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; margin-bottom:16px; }
    .cards-grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .col-12{ grid-column: span 12; } .col-8{ grid-column: span 8; } .col-6{ grid-column: span 6; } .col-5{ grid-column: span 5; } .col-4{ grid-column: span 4; } .col-3{ grid-column: span 3; } .col-2{ grid-column: span 2; }
    @media (max-width: 900px){ .col-8{ grid-column: span 12;} .col-6{ grid-column: span 12;} .col-5{ grid-column: span 12;} .col-4{ grid-column: span 12;} .col-3{ grid-column: span 6;} .col-2{ grid-column: span 6;} }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, select, textarea{ width:100%; padding:8px 10px; background:var(--input); color:var(--text); border-radius:10px; border:1px solid var(--line); }
    input[type="checkbox"], input[type="radio"]{ width:auto; }
    textarea{ min-height:90px; resize:vertical; }
    button{ cursor:pointer; border:none; background:var(--brand); color:black; padding:8px 12px; border-radius:10px; }
    button.ghost{ background:transparent; color:var(--text); border:1px solid var(--line); }
    table{ width:100%; border-collapse: collapse; }
    th, td{ border-bottom:1px dashed var(--line); padding:8px; text-align:left; vertical-align:top; }
    th{ font-size:13px; color:var(--muted); }
    td{ font-size:14px; }
    .muted{ color:var(--muted); }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
    .chip{ border:1px solid var(--line); padding:4px 8px; border-radius:999px; font-size:12px; }
    .right{ margin-left:auto; }
    .danger{ background:var(--danger); color:white; }
    .ok{ background:var(--ok); color:black; }
    .warn{ background:var(--warn); color:black; }
    .badge{ font-size:12px; padding:2px 6px; border-radius:6px; background:var(--input); border:1px solid var(--line); color:var(--text); }
    .kpi{ font-weight:700; font-size:18px; }
    .big{ font-size:18px; font-weight:600;}
    .small{ font-size:12px; }
    .thumb{ width:40px; height:40px; object-fit:cover; border-radius:6px; border:1px solid var(--line); cursor:pointer; }
    .viewer{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:50; }
    .viewer img{ max-width:90vw; max-height:90vh; border-radius:12px; border:1px solid var(--line); }
    .calendar{ user-select:none; }
    .cal-head{ display:flex; align-items:center; gap:8px; }
    .cal-grid{ display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; }
    .cal-cell{ text-align:center; padding:6px 0; border-radius:8px; border:1px solid var(--line); background:var(--input); cursor:pointer; position:relative;}
    .cal-cell .dot{ position:absolute; bottom:4px; left:50%; transform:translateX(-50%); width:6px; height:6px; border-radius:999px; background:var(--brand); }
    .cal-cell.active{ outline:2px solid var(--brand); background:rgba(14,165,233,.15); }
    .dropzone{ padding:6px 10px; background:rgba(14,165,233,.08); border:1px dashed var(--line); border-radius:10px; margin:6px 0; }
    .flight{ display:flex; gap:12px; align-items:flex-start; }
    .plane{ font-size:28px; line-height:1; }
    .countdown{ font-weight:700; }
    .sticky-foot{ position:sticky; bottom:0; background:var(--card); border-top:1px solid var(--line); padding:6px 8px; z-index:5; }
    .pill{ padding:2px 8px; border-radius:999px; border:1px solid var(--line); }
    canvas{ width:100%; height:280px; }
  
  input[type="date"], input[type="time"], select, textarea{ color-scheme:dark; }
  body.light input[type="date"], body.light input[type="time"], body.light select, body.light textarea{ color-scheme:light; }
  ::placeholder{ color: var(--muted); }
  @media (max-width:640px){ table.compact td, table.compact th{ padding:6px 8px; } .chip{ margin:4px 4px 0 0; } }
    
/* v4.3.7 fixes */
#miniCalendar .mini-header{display:flex;justify-content:space-between;align-items:center;margin:2px 0 4px;color:var(--muted)}
#miniCalendar .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
#miniCalendar .cal-cell{padding:6px 0;border:1px solid var(--line);border-radius:8px;text-align:center;cursor:pointer;position:relative}
#miniCalendar .cal-cell.active{outline:2px solid var(--brand)}
#miniCalendar .cal-cell .dot{position:absolute;bottom:3px;left:50%;transform:translateX(-50%);width:6px;height:6px;border-radius:50%;background:var(--brand)}
#recentIt .card{padding:6px 10px} #recentIt .row{margin:2px 0!important}
#itinerary .dropzone{font-size:12px;opacity:.55;padding:6px;border-style:dashed}
    #lodging input#lo_name{width:100%}
    /* Ensure lodging name field remains full width on H5 */
    #lodging #lo_name{width:100%}
    #lodging .cards-grid{grid-template-columns: repeat(12, 1fr);}
    #lodging .col-5:has(#lo_name){grid-column: span 8;}
    @media (max-width: 900px){
      #lodging .col-5:has(#lo_name){grid-column: span 12;}
    }
#chartCat, #chartPeople{display:none!important} /* ç›´æ¥éšè—å›¾è¡¨ */
nav a[href="#memories"]{display:none!important}

</style>
  <link rel="stylesheet" href="patch.css">
<style>
/* v4.3.7 injected: responsive mini calendar on Home + wide telegram inputs + hide Memories nav */
:root{
  --mini-cal-gap: 6px;
  --mini-cal-cell: 36px;
}
/* Ensure Home mini calendar styles override external patch.css */
#home #miniCalendar .mini-header{display:flex;justify-content:space-between;align-items:center;margin:2px 0 4px;color:var(--muted)}
#home #miniCalendar .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
#home #miniCalendar .cal-cell{padding:6px 0;border:1px solid var(--line);border-radius:8px;text-align:center;cursor:pointer;position:relative}
#home #miniCalendar .cal-cell.active{outline:2px solid var(--brand)}
#home #miniCalendar .cal-cell .dot{position:absolute;bottom:3px;left:50%;transform:translateX(-50%);width:6px;height:6px;border-radius:50%;background:var(--brand)}
@media (max-width: 600px){
  #home #miniCalendar {padding: 8px 10px;}
  #home #miniCalendar .mini-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
  #home #miniCalendar .cal-grid{
    display:grid;
    grid-template-columns: repeat(7,1fr);
    gap: var(--mini-cal-gap);
  }
  #home #miniCalendar .cal-cell{
    height: var(--mini-cal-cell);
    display:flex;align-items:center;justify-content:center;
    border:1px solid var(--line, rgba(255,255,255,.08));
    border-radius:10px;
    font-size:14px;
    user-select:none;
  }
  #home #miniCalendar .cal-cell.today{outline:2px solid #4db4ff; box-shadow:0 0 0 3px rgba(77,180,255,.15) inset;}
  #home #miniCalendar .cal-cell.has{background:rgba(77,180,255,.12);}
}

/* Make Telegram inputs wider & in a row */
#settings .tg-row{display:flex; gap:12px; margin-top:8px; flex-wrap:wrap;}
#settings .tg-row .tg-field{flex:1 1 280px; min-width:260px;}
#settings .tg-row .tg-field input{width:100%;}
/* Hide 'å›å¿†' nav if still present */
a[href*="#memories"], #memories { display:none !important; }

  /* H5: itinerary item actions (ä¿®æ”¹/åˆ é™¤) stacked at right */
  @media (max-width: 640px){
    #it_groups .card > .row:has(button._edit):has(button[onclick^="UI.delItemByIndex("]){
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:flex-start;
      gap:6px;
    }
    #it_groups .card > .row:has(button._edit):has(button[onclick^="UI.delItemByIndex("]) button.ghost{
      grid-column:2;
      justify-self:end;
      width:auto;
      min-width:66px;
    }
    #it_groups .card > .row:has(button._edit):has(button[onclick^="UI.delItemByIndex("]) button.ghost._edit{ margin-bottom:6px; }
    #it_groups .card > .action-row{ display:grid; grid-template-columns: 1fr auto; gap:6px; align-items:center; }
    #it_groups .card > .action-row button.ghost{ grid-column:2; justify-self:end; }
    #it_groups .card > .action-row button.ghost.move{ margin-bottom:6px; }
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="nav" id="nav"></div>
    <div class="nav">
      <div class="spacer"></div>
      <button id="themeBtn" class="theme" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™/â˜€ï¸</button>
    </div>
  </div>
<div style="position:fixed;right:16px;bottom:12px;z-index:99;font-size:12px;color:#94a3b8">v4.3.7</div></header>

<main class="wrap">

  <!-- é¦–é¡µ -->
  <section id="home" class="card">
    <h2>ğŸ  é¦–é¡µ</h2>
    <div class="cards-grid">
      <div class="col-8">
        <div class="card">
          <div class="row">
            <div class="kpi">æ—…è¡Œä¿¡æ¯</div>
            <span class="badge" id="teamCount">0 äºº</span>
            <span class="right big" id="tripDates"></span>
          </div>
          <div class="cards-grid" style="margin-top:8px;">
            <div class="col-4"><label>æ—…è¡Œå¼€å§‹</label><input type="date" id="st_start"></div>
            <div class="col-4"><label>æ—…è¡Œç»“æŸ</label><input type="date" id="st_end"></div>
            <div class="col-4"><label>ç›®çš„åœ°</label><input id="st_dest" value="å°åŒ—"></div>
            <div class="col-12 row"><button onclick="App.saveTripInfo()">ä¿å­˜æ—…è¡Œä¿¡æ¯</button></div>
          </div>
        </div>
        <div class="card" id="homeFlights">
          <div class="row"><div class="kpi">ğŸ›« èˆªç­</div><span class="right small muted"><a href="#transport" onclick="App.show('transport')">å»æ·»åŠ </a></span></div>
          <div id="flightList" class="small muted">æ²¡æœ‰â€œé£è¡Œâ€äº¤é€šè®°å½•ã€‚</div>
        </div>
      </div>
      <div class="col-4">
        <div class="card">
          <div class="row"><div class="kpi">ğŸ“… å°æ—¥å†</div><span class="right small muted"><a href="#itinerary" onclick="App.show('itinerary')">ç®¡ç†è¡Œç¨‹</a></span></div>
          <div id="miniCalendar" class="calendar"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="row"><div class="kpi">æœ€è¿‘è¡Œç¨‹</div><span class="right small muted"><a href="#itinerary" onclick="App.show('itinerary')">å»æ·»åŠ </a></span></div>
      <div id="recentIt">è¿˜æ²¡æœ‰è¡Œç¨‹ï¼Œå…ˆå»æ·»åŠ å§ã€‚</div>
    </div>
  </section>

  <!-- è¡Œç¨‹ -->
  <section id="itinerary" class="card" hidden>
    <h2>ğŸ“… è¡Œç¨‹ï¼ˆåˆ†ç»„ + æ‹–æ‹½ï¼‰</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-3"><label>æ—¥æœŸ</label><input type="date" id="it_date"></div>
        <div class="col-3"><label>å¼€å§‹æ—¶é—´</label><input type="time" id="it_start"></div>
        <div class="col-3"><label>ç»“æŸæ—¶é—´</label><input type="time" id="it_end"></div>
        <div class="col-3"><label>æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label><input type="number" id="it_hours" step="0.25" placeholder="å¦‚ 2.5"></div>
        <div class="col-6"><label>æ´»åŠ¨å†…å®¹</label><input id="it_title" placeholder="å¦‚ï¼šååˆ†è€è¡— â†’ ä¹ä»½å±±åŸ"></div>
        <div class="col-6"><label>åœ°ç‚¹</label><input id="it_place" placeholder="å¦‚ï¼šä¹ä»½ã€ååˆ†"></div>
        <div class="col-4"><label>äº¤é€šæ–¹å¼</label>
          <select id="it_mode"><option>åŒ…è½¦</option><option>åœ°é“</option><option>æ­¥è¡Œ</option><option>é£æœº</option><option>é£è¡Œ</option><option>é«˜é“</option><option>æ¸¸èˆ¹</option><option>å…¶ä»–</option></select>
        </div>
        <div class="col-4"><label>ç©¿ç€å»ºè®®</label><input id="it_wear" placeholder="é˜²æ™’/é›¨å…·/èˆ’é€‚é‹..."></div>
        <div class="col-4"><label>æ­¥è¡Œ/äº¤é€šæ—¶é—´</label><input id="it_walk" placeholder="æ·è¿XXâ†’XXï¼Œçº¦15åˆ†é’Ÿ"></div>
        <div class="col-12"><label>è¯„åˆ†/æ¨è & é“¾æ¥</label><input id="it_links" placeholder="Googleè¯„åˆ†ã€é¤å…/æ™¯ç‚¹/IGé“¾æ¥"></div>
        <div class="col-12"><label>å¤‡æ³¨ / Plan B</label><textarea id="it_note" placeholder="å®¤å†…æ›¿ä»£æ´»åŠ¨ã€æ³¨æ„äº‹é¡¹ç­‰"></textarea></div>
        <div class="col-12 row">
          <button onclick="UI.addItinerary()">æ·»åŠ è¡Œç¨‹</button>
          <button class="ghost right" onclick="App.exportJSON()">å¯¼å‡ºå¤‡ä»½</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="row"><div class="kpi">ğŸ“† å°æ—¥å†</div></div>
      <div id="itCalendar" class="calendar"></div>
    </div>

    <div id="it_groups"></div>
  </section>

  <!-- ä½å®¿ -->
  <section id="lodging" class="card" hidden>
    <h2>ğŸ¨ ä½å®¿ä¿¡æ¯</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-3"><label>æ—¥æœŸ</label><input type="date" id="lo_date"></div>
        <div class="col-5"><label>é…’åº—/æ°‘å®¿åç§°</label><input id="lo_name"></div>
        <div class="col-4"><label>æˆ¿å‹</label><input id="lo_room"></div>
        <div class="col-6"><label>åœ°å€</label><input id="lo_addr"></div>
        <div class="col-3"><label>å…¥ä½æ—¶é—´</label><input type="time" id="lo_in"></div>
        <div class="col-3"><label>é€€æˆ¿æ—¶é—´</label><input type="time" id="lo_out"></div>
        <div class="col-6"><label>é¢„è®¢é“¾æ¥</label><input id="lo_link"></div>
        <div class="col-3"><label>è”ç³»äºº/ç”µè¯</label><input id="lo_contact"></div>
        <div class="col-3"><label>æˆ¿é—´åˆ†é…</label><input id="lo_assign" placeholder="å¦‚ï¼šAæˆ¿ 2äººï¼ŒBæˆ¿ 3äºº"></div>
        <div class="col-12"><label>ç‰¹æ®Šéœ€æ±‚</label><textarea id="lo_note"></textarea></div>
        <div class="col-12 row"><button onclick="UI.addLodging()">æ·»åŠ ä½å®¿</button></div>
      </div>
    </div>
    <table id="lo_table"><thead><tr><th>æ—¥æœŸ</th><th>åç§°/æˆ¿å‹</th><th>åœ°å€</th><th>æ—¶é—´</th><th>è”ç³»äºº</th><th>åˆ†é…</th><th></th></tr></thead><tbody></tbody></table>
  </section>

  <!-- äº¤é€š -->
  <section id="transport" class="card" hidden>
    <h2>ğŸš— äº¤é€šå®‰æ’</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-3"><label>æ—¥æœŸ</label><input type="date" id="tr_date"></div>
        <div class="col-3"><label>å‡ºå‘æ—¶é—´</label><input type="time" id="tr_out"></div>
        <div class="col-3"><label>åˆ°è¾¾æ—¶é—´</label><input type="time" id="tr_in"></div>
        <div class="col-3"><label>æ–¹å¼</label>
          <select id="tr_mode"><option>é£æœº</option><option>é£è¡Œ</option><option>åŒ…è½¦</option><option>åœ°é“</option><option>æ­¥è¡Œ</option><option>é«˜é“</option><option>æ¸¸èˆ¹</option><option>å…¶ä»–</option></select>
        </div>
        <div class="col-4"><label>èˆªç­å·ï¼ˆé£è¡Œæ—¶å¡«å†™ï¼‰</label><input id="tr_flight"></div>
        <div class="col-4"><label>èµ·é£æœºåœº</label><input id="tr_from"></div>
        <div class="col-4"><label>é™è½æœºåœº</label><input id="tr_to"></div>
        <div class="col-6"><label>é›†åˆç‚¹</label><input id="tr_meet"></div>
        <div class="col-6"><label>å¸æœº/èˆªç­ä¿¡æ¯</label><input id="tr_info"></div>
        <div class="col-6"><label>é¢„è®¢é“¾æ¥</label><input id="tr_link"></div>
        <div class="col-6"><label>å¤‡æ³¨</label><input id="tr_note"></div>
        <div class="col-12 row"><button onclick="UI.addTransport()">æ·»åŠ äº¤é€š</button></div>
      </div>
    </div>
    <table id="tr_table"><thead><tr><th>æ—¥æœŸ</th><th>æ—¶é—´</th><th>æ–¹å¼</th><th>èˆªç­/æœºåœº</th><th>é›†åˆç‚¹/ä¿¡æ¯</th><th>å¤‡æ³¨</th><th></th></tr></thead><tbody></tbody></table>
  </section>

  <!-- æºå¸¦ç‰©å“ï¼ˆåˆ†ç»„æŠ˜å +å¯æ”¹åˆ†ç»„ï¼‰ -->
  <section id="packing" class="card" hidden>
    <h2>ğŸ‘œ æºå¸¦ç‰©å“æ¸…å•</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-6"><label>ç‰©å“åç§°</label><input id="pk_name"></div>
        <div class="col-3"><label>åˆ†ç»„</label><input id="pk_group" placeholder="è¯ä»¶/è¡£ç‰©/è¯å“..."></div>
        <div class="col-3"><label>å¤‡æ³¨</label><input id="pk_note"></div>
        <div class="col-12 row"><button onclick="UI.addPack()">æ·»åŠ ç‰©å“</button><button class="ghost" onclick="UI.loadDefaultPack()">åŠ è½½é¢„è®¾æ¸…å•</button></div>
      </div>
    </div>
    <div id="pk_groups"></div>
  </section>

  <!-- è®°è´¦ -->
  <section id="expenses" class="card" hidden>
    <h2>ğŸ’° å›¢ä½“è®°è´¦ & ç»“ç®—</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-3"><label>æ—¥æœŸ</label><input type="date" id="ex_date"></div>
        <div class="col-3"><label>æ—¶é—´</label><input type="time" id="ex_time"></div>
        <div class="col-3"><label>é‡‘é¢</label><input type="number" id="ex_amount" step="0.01"></div>
        <div class="col-3"><label>å¸ç§</label><select id="ex_ccy"><option>MYR</option><option>TWD</option></select></div>
        <div class="col-3"><label>æ±‡ç‡ï¼ˆTWDâ†’MYRï¼‰</label><input type="number" id="ex_fx" step="0.0001" placeholder="TWDè½¬MYRæ±‡ç‡"></div>
        <div class="col-6"><label>åœ°ç‚¹</label><input id="ex_place"></div>
        <div class="col-6"><label>å†…å®¹</label><input id="ex_desc"></div>
        <div class="col-4"><label>ä»˜æ¬¾äºº</label><select id="ex_payer"></select></div>
        <div class="col-8"><label>å‚ä¸æˆå‘˜</label>
          <div class="row" id="ex_participants"></div>
          <div class="row small"><button class="ghost" onclick="UI.participantsSelectAll(true)">å…¨é€‰</button><button class="ghost" onclick="UI.participantsSelectAll(false)">å…¨ä¸é€‰</button></div>
        </div>
        <div class="col-4"><label>æ˜¯å¦è¯·å®¢</label><select id="ex_treat"><option value="no">å¦</option><option value="yes">æ˜¯</option></select></div>
        <div class="col-4"><label>åˆ†ç±»</label>
          <select id="ex_cat"><option>é¤é¥®</option><option>ä½å®¿</option><option>äº¤é€š</option><option>è´­ç‰©</option><option>æ™¯ç‚¹</option><option>å…¶ä»–</option></select>
        </div>
        <div class="col-4"><label>å…¶ä»–åˆ†ç±»ï¼ˆå½“ä¸Šé¢é€‰â€œå…¶ä»–â€æ—¶ï¼‰</label><input id="ex_cat_other" placeholder="è‡ªå®šä¹‰åˆ†ç±»" disabled></div>
        <div class="col-4"><label>ä»˜æ¬¾æ–¹å¼</label><input id="ex_method" placeholder="ç°é‡‘/ä¿¡ç”¨å¡/æ”¯ä»˜å®/å…¶ä»–"></div>
        <div class="col-6"><label>è´¦å•å›¾ç‰‡</label><input type="file" id="ex_bill" accept="image/*"></div>
        <div class="col-12 row"><button onclick="UI.addExpense()">è®°å½•ä¸€ç¬”</button><button class="ghost" onclick="UI.recalc()">é‡æ–°ç»Ÿè®¡</button><button class="ghost" onclick="UI.exportCSV()">å¯¼å‡ºCSV</button></div>
      </div>
    </div>
    <div class="cards-grid">
      <div class="col-12">
        <table id="ex_table"><thead><tr><th>æ—¥æœŸ</th><th>é‡‘é¢(MYR)</th><th>åŸå¸</th><th>åœ°ç‚¹/å†…å®¹</th><th>å‚ä¸</th><th>ä»˜æ¬¾äºº</th><th>åˆ†ç±»</th><th>æ–¹å¼</th><th>ç¥¨æ®</th><th></th></tr></thead><tbody></tbody></table>
      </div>
      <div class="col-12 card" id="settlement"></div>
      <div class="col-6 card">
        <h3>æ”¯å‡ºåˆ†ç±»å›¾</h3>
        <canvas id="chartCat"></canvas>
      </div>
      <div class="col-6 card">
        <h3>æŒ‰äººç»“ç®—å›¾</h3>
        <canvas id="chartPeople"></canvas>
      </div>
    </div>
  </section>

  <!-- å›¢é˜Ÿä¸ä»»åŠ¡ -->
  <section id="team" class="card" hidden>
    <h2>ğŸ‘¥ å›¢é˜Ÿæˆå‘˜</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-6"><label>å§“å</label><input id="tm_name" placeholder="å¦‚ï¼šå¤§å“¥"></div>
        <div class="col-6"><label>è”ç³»æ–¹å¼ï¼ˆé€‰å¡«ï¼‰</label><input id="tm_contact" placeholder="ç”µè¯/å¾®ä¿¡"></div>
        <div class="col-12 row"><button onclick="UI.addTeam()">æ·»åŠ æˆå‘˜</button><button class="ghost" onclick="UI.loadDefaultTeam()">åŠ è½½10äººç¤ºä¾‹</button></div>
      </div>
    </div>
    <table id="tm_table"><thead><tr><th>å§“å</th><th>è”ç³»æ–¹å¼</th><th></th></tr></thead><tbody></tbody></table>
  </section>

  <!-- è”ç³»äºº -->
  <section id="contacts" class="card" hidden>
    <h2>ğŸ“ ç´§æ€¥è”ç³»äºº</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-4"><label>åç§°</label><input id="ct_name"></div>
        <div class="col-4"><label>ç”µè¯</label><input id="ct_phone"></div>
        <div class="col-4"><label>èŒè´£</label><input id="ct_role"></div>
        <div class="col-12 row"><button onclick="UI.addContact()">æ·»åŠ </button><button class="ghost" onclick="UI.loadDefaultContacts()">åŠ è½½å°æ¹¾å¸¸ç”¨</button></div>
      </div>
    </div>
    <table id="ct_table"><thead><tr><th>åç§°</th><th>ç”µè¯</th><th>èŒè´£</th><th></th></tr></thead><tbody></tbody></table>
  </section>

  <!-- å›å¿† -->
  <section id="memories" class="card" hidden>
    <h2>ğŸ“· æ—…è¡Œå›å¿†</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-3"><label>æ—¥æœŸ</label><input type="date" id="mm_date"></div>
        <div class="col-9"><label>æ„Ÿæƒ³</label><input id="mm_note" placeholder="ä¸€å¥è¯è®°å½•"></div>
        <div class="col-12"><label>ç…§ç‰‡é“¾æ¥ï¼ˆå¯è´´Google Photos/IGé“¾æ¥ï¼‰</label><input id="mm_url" placeholder="https://"></div>
        <div class="col-12 row"><button onclick="UI.addMemory()">æ·»åŠ å›å¿†</button></div>
      </div>
    </div>
    <table id="mm_table"><thead><tr><th>æ—¥æœŸ</th><th>ç…§ç‰‡</th><th>æ„Ÿæƒ³</th><th></th></tr></thead><tbody></tbody></table>
  </section>

  <!-- è®¾ç½®/å¤‡ä»½ -->
  <section id="settings" class="card" hidden>
    <h2>âš™ï¸ è®¾ç½® / å¤‡ä»½</h2>
    <div class="card">
      <div class="cards-grid">
        <div class="col-4"><label>æœºåœºæé†’ï¼ˆèµ·é£å‰Xå°æ—¶ï¼‰</label><input type="number" id="set_flight_alert" min="1" step="1"></div>
        <div class="col-8 row" style="align-items:flex-end;"><button onclick="UI.saveSettings()">ä¿å­˜è®¾ç½®</button></div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <button onclick="App.exportJSON()">å¯¼å‡ºJSONå¤‡ä»½</button>
        <input type="file" id="importFile" accept="application/json" style="display:none" onchange="App.importJSON(event)">
        <button class="ghost" onclick="document.getElementById('importFile').click()">å¯¼å…¥JSON</button>
      </div>
    </div>
    <div class="small muted">æ³¨ï¼šæ•°æ®ä¿å­˜åœ¨æœ¬æœºï¼ˆlocalStorageï¼‰ï¼Œä¸ä¸Šä¼ ç½‘ç»œã€‚</div>
  
    <!-- Gist Sync (Cloud) -->
    <div class="row" style="margin-top:16px">
      <div class="col">
        <label>GitHub Gist Tokenï¼ˆä»…å‹¾ gist æƒé™ï¼‰</label>
        <input id="gist_token" type="password" placeholder="ghp_xxx" style="width:100%">
      </div>
      <div class="col">
        <label>Gist IDï¼ˆé¦–æ¬¡ä¸Šä¼ ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰</label>
        <input id="gist_id" type="text" placeholder="e.g. 12ab34cd..." style="width:100%">
      </div>
    </div>
    <div class="row" style="gap:8px;margin-top:12px">
      <button id="btnGistPush" class="ghost">ä¸Šä¼ åˆ°äº‘</button>
      <button id="btnGistPull" class="ghost">ä»äº‘æ¢å¤</button>
      <label style="display:flex;align-items:center;gap:8px">
        <input id="gist_auto" type="checkbox"> è‡ªåŠ¨åŒæ­¥ï¼ˆä¿å­˜æ—¶è‡ªåŠ¨æ¨é€ï¼‰
      </label>
    </div>
    <small>è¯´æ˜ï¼šToken ä¸ Gist ID ä»…ä¿å­˜åœ¨æœ¬æœºï¼›æ¢è®¾å¤‡éœ€é‡æ–°å¡«å†™ã€‚</small>
    </section>

</main>

<!-- å¤§å›¾æŸ¥çœ‹ -->
<div id="imgViewer" class="viewer" onclick="this.style.display='none'">
  <img id="imgView" alt="ç¥¨æ®é¢„è§ˆ">
</div>

<script src="app.js"></script>
<script src="patch.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
  }
</script>
<script>
/* v4.3.7 injected helpers */
(function(){
  function qs(s, r){ return (r||document).querySelector(s); }
  function qsa(s, r){ return Array.from((r||document).querySelectorAll(s)); }

  // (removed) HOME mini-calendar auto DOM injection to avoid double headers and layout conflicts

  // SETTINGS: widen telelgram inputs
  try{
    var settings = qs('#settings');
    if(settings && !qs('.tg-row', settings)){
      var tokenInput = qsa('#settings input').find(x=>(x.previousElementSibling && /Bot Token/i.test(x.previousElementSibling.textContent))) || null;
      var chatInput  = qsa('#settings input').find(x=>(x.previousElementSibling && /Chat ID/i.test(x.previousElementSibling.textContent))) || null;
      if(tokenInput){
        var wrap = document.createElement('div'); wrap.className='tg-row';
        var fx1 = document.createElement('div'); fx1.className='tg-field';
        var fx2 = document.createElement('div'); fx2.className='tg-field';
        tokenInput.parentElement.insertBefore(wrap, tokenInput.parentElement.firstChild);
        fx1.appendChild(tokenInput);
        wrap.appendChild(fx1);
        if(chatInput){
          fx2.appendChild(chatInput);
          wrap.appendChild(fx2);
        }
      }
    }
  }catch(e){ console.warn('[v437] settings patch fail', e); }

  // NAV: remove memories tab if still present
  qsa('nav a, .tabs a, .navbar a').forEach(function(a){
    if(/å›å¿†/.test(a.textContent)){ a.remove(); }
  });
})();
</script>
<script src="gist_sync.js"></script>
</body>
</html>
